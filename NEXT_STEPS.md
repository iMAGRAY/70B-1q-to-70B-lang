# Дальнейшие шаги по разработке SIGLA

Этот документ описывает конкретные действия для создания работоспособного прототипа. Цель – получить систему, которая на локальном оборудовании умеет хранить знания и подавать их модели 1Q.

## 1. Подготовка капсул
1. Составить 20–30 наиболее важных вопросов, которые должна уметь освещать 1Q.
2. Получить ответы из LLaMA3‑70B или другой модели. Стараться делать запросы батчами, чтобы снизить стоимость.
3. Разбить ответы на короткие утверждения. Каждое утверждение – отдельная капсула.
4. Очистить тексты от личных данных и лишних цифр, сохранить в формате NDJSON.
5. Посчитать эмбеддинги через `python -m sigla embed` и проверить размерность векторов.

## 2. Построение индекса
1. Создать индекс командой `python -m sigla ingest data.json my_index --model sentence-transformers/all-MiniLM-L6-v2`.
2. Проверить метаданные: `python -m sigla info my_index` должно показать количество капсул и выбранную модель.
3. Провести несколько пробных поисков `python -m sigla search my_index "пример запроса"` и оценить качество.

## 3. Запуск сервера
1. Запустить локальный API: `python -m sigla server --index my_index`.
2. Через `curl` проверить эндпоинты `/search`, `/ask`, `/walk`. Убедиться, что ответы приходят в формате JSON.
3. Включить логирование (`--log-file sigla.log`) и проверить, что в логах фиксируются события и время.

## 4. Интеграция локального LLM
1. Установить `llama-cpp-python` или другую библиотеку для локального запуска модели.
2. Проверить `python -m sigla answer "вопрос"` – команда должна вывести ответ, используя найденные капсулы и локальный LLM.
3. Подобрать параметры `--top_k`, `--temperature`, `--min_rating` для наиболее осмысленных ответов.

## 5. Расширение возможностей
1. Реализовать автоматическую связь капсул (`--link`), чтобы новые капсулы соединялись с ближайшими по смыслу.
2. Реализовать `walk` с `--algo random`, протестировать расширение контекста через граф.
3. Добавить в README раздел о работе без тяжёлых моделей, объяснить использование `--model hash` и переменных окружения `$SIGLA_MODEL`, `$SIGLA_INDEX`.

## 6. Тестирование и автоматизация
1. Создать набор unit-тестов для ключевых функций (`embed`, `search`, `answer`).
2. Настроить скрипт проверки: ingest → search → answer → export. Автоматический запуск убедится, что каждое обновление не ломает базовую логику.
3. Использовать `sigla stats sigla.log` для анализа производительности и выявления узких мест.

## 7. Итоговые шаги
1. После отладки всех команд собрать инструкции в README и описать минимальные системные требования.
2. Подготовить примеры API-запросов и ожидаемых ответов.
3. На этом этапе прототип готов. Дальнейшее развитие можно сосредоточить на более глубокой интеграции с KV-кешем и расширении базы капсул.
